<div id="chapter" class="content" ng-class="!chapter ? 'wait' : ''">
    <form name="chapterForm" novalidate>
        <div class="header">
            <input type="text" ng-model="chapter.Name" ng-keydown="chapterTitleKeyPressed($event)" class="no-border" tabindex="1" />
            <!--<div class="right">
                <a href="#" ng-click="close()">close</a>
            </div>-->
        </div>
        <div class="body">
            <textarea ng-model="chapter.Desc" class="no-border" tabindex="2"></textarea>
        </div>
        <div class="footer">
            <img ng-if="!chapter || wait" src="/Content/icon/wait.gif" class="icon20" />
            <span class="button-medium-blue" ng-click="save(false)" tabindex="3">Сохранить</span>
            <span class="button-medium-blue" ng-click="save(true)" tabindex="4">Сохранить и закрыть</span>
        </div>
    </form>
    <div class="chapter-links-block" ng-show="chapterLinks.length > 0">
        <form name="chapterLinkBlockForm">
            <div class="chapter-link" ng-repeat="chapterLink in chapterLinks">
                <div class="text">
                    <input ng-model="chapterLink.Text" class="no-border" ng-blur="updateChpaterLink(chapterLink)" tabindex="{{ 6 + $index}}" />
                    <hr />
                    <p>
                        Условий для видимости данно выбора:
                    </p>
                    <p ng-repeat="requirement in chapterLink.Requirements">
                        {{requirement.StateType.Name}} <span class="changeType">{{requirement.RequirementType.Name}}</span> {{requirement.Value}}
                        <a href="#" ng-click="removeRequirement(chapterLink, requirement.Id, $index)">X</a>
                    </p>
                    <p class="variable-action">
                        <select ng-model="chapterLink.newRequirement.StateType"
                                ng-options="stateType as stateType.Name for stateType in chapter.StateTypes"
                                ng-change="updateRequirementType(chapterLink)"></select>

                        <select ng-model="chapterLink.newRequirement.RequirementType.Value"
                                ng-options="requirementType.Value as requirementType.Name for requirementType in chapterLink.RequirementTypes"></select>

                        <input type="text" ng-model="chapterLink.newRequirement.Value"
                               ng-show="chapterLink.newRequirement.RequirementType.Value != 5
                                    && chapterLink.newRequirement.RequirementType.Value != 6" />
                        <input type="button" value="+" ng-click="saveNewRequirement(chapterLink)" />
                    </p>
                    <hr />
                    <p>
                        Изменения состояния в случае выбора:
                    </p>
                    <p ng-repeat="change in chapterLink.Changes">
                        {{change.StateType.Name}} <span class="changeType">{{change.ChangeType.Name}}</span> {{change.Value}}
                        <a href="#" ng-click="removeChange(chapterLink, change.Id, $index)">X</a>
                    </p>
                    <p class="variable-action">
                        <select ng-model="chapterLink.newChange.StateType"
                                ng-options="stateType as stateType.Name for stateType in chapter.StateTypes"
                                ng-change="updateChangeType(chapterLink)"></select>

                        <select ng-model="chapterLink.newChange.ChangeType.Value"
                                ng-options="changeType.Value as changeType.Name for changeType in chapterLink.ChangeTypes"></select>

                        <input type="text" ng-model="chapterLink.newChange.Value"
                               ng-show="chapterLink.newChange.ChangeType.Value != 4" />
                        <input type="button" value="+" ng-click="saveNewChange(chapterLink)" />
                    </p>
                </div>
                <div class="action-button">
                    <p>
                        <a href="#">
                            <span class="button-medium-blue">
                                {{chapterLink.Text ? resources.Travel_GetChosen : resources.Travel_Next}} <span class="author-tips">{{chapterLink.ToChapterName}}</span>
                            </span>
                        </a>
                    </p>
                    <!--<div class="condition">
                        <p>
                            <label>
                                Добавить условие
                                <input type="checkbox"
                                       ng-disabled="chapterLink.Condition"
                                       ng-init="addCondition = !!chapterLink.Condition"
                                       ng-model="addCondition" />
                            </label>
                        </p>
                        <p ng-if="addCondition">
                            {{chapterLink.Condition}}
                            <select ng-model="chapterLink.Condition">
                                <option value="" selected>Выбери решение</option>
                                <option value="{{decision}}" ng-repeat="decision in availableDecision">{{decision}}</option>
                            </select>
                            <span class="button-medium-blue" ng-click="saveCondition(chapterLink)">Сохранить</span>
                        </p>
                    </div>-->

                    <!--<div class="decision">
                        <p>
                            <label>
                                Запомнить решение
                                <input type="checkbox"
                                       ng-disabled="chapterLink.Decision"
                                       ng-init="rememberDecision = !!chapterLink.Decision"
                                       ng-model="rememberDecision" />
                            </label>
                        </p>
                        <p ng-if="rememberDecision || chapterLink.Decision">
                            <input type="text" ng-model="chapterLink.Decision" placeholder="Метка решения" />
                            <span class="button-medium-blue" ng-click="saveDecision(chapterLink)">Сохранить</span>
                        </p>
                    </div>-->
                </div>
            </div>
        </form>
    </div>
    <!--<div>
        <span class="button-medium-blue" ng-click="createNextChapter()">создать следующую главу</span>
    </div>-->

</div>
